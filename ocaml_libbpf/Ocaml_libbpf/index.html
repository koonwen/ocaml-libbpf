<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Ocaml_libbpf (ocaml_libbpf.Ocaml_libbpf)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../index.html">ocaml_libbpf</a> &#x00BB; Ocaml_libbpf</nav><header class="odoc-preamble"><h1>Module <code><span>Ocaml_libbpf</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec module anchored" id="module-C"><a href="#module-C" class="anchor"></a><code><span><span class="keyword">module</span> <a href="C/index.html">C</a></span><span> : <span class="keyword">module</span> <span class="keyword">type</span> <span class="keyword">of</span> <a href="../C/index.html">C</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-major_version"><a href="#val-major_version" class="anchor"></a><code><span><span class="keyword">val</span> major_version : int</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-minor_version"><a href="#val-minor_version" class="anchor"></a><code><span><span class="keyword">val</span> minor_version : int</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-version_string"><a href="#val-version_string" class="anchor"></a><code><span><span class="keyword">val</span> version_string : string</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bpf_attach_type_str"><a href="#val-bpf_attach_type_str" class="anchor"></a><code><span><span class="keyword">val</span> bpf_attach_type_str : <span><a href="../C_function_description/Types/Bpf_attach_type/index.html#type-t">C.Types.Bpf_attach_type.t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bpf_link_type_str"><a href="#val-bpf_link_type_str" class="anchor"></a><code><span><span class="keyword">val</span> bpf_link_type_str : <span><a href="../C_function_description/Types/Bpf_link_type/index.html#type-t">C.Types.Bpf_link_type.t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bpf_map_type_str"><a href="#val-bpf_map_type_str" class="anchor"></a><code><span><span class="keyword">val</span> bpf_map_type_str : <span><a href="../C_function_description/Types/Bpf_map_type/index.html#type-t">C.Types.Bpf_map_type.t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bpf_prog_type_str"><a href="#val-bpf_prog_type_str" class="anchor"></a><code><span><span class="keyword">val</span> bpf_prog_type_str : <span><a href="../C_function_description/Types/Bpf_prog_type/index.html#type-t">C.Types.Bpf_prog_type.t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-bpf_object"><a href="#type-bpf_object" class="anchor"></a><code><span><span class="keyword">type</span> bpf_object</span><span> = <span><span><a href="../C_function_description/Types/index.html#type-bpf_object">C.Types.bpf_object</a> <span class="xref-unresolved">Ctypes</span>.structure</span> <span class="xref-unresolved">Ctypes</span>.ptr</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-bpf_program"><a href="#type-bpf_program" class="anchor"></a><code><span><span class="keyword">type</span> bpf_program</span><span> = </span><span>{</span></code><ol><li id="type-bpf_program.name" class="def record field anchored"><a href="#type-bpf_program.name" class="anchor"></a><code><span>name : string;</span></code></li><li id="type-bpf_program.fd" class="def record field anchored"><a href="#type-bpf_program.fd" class="anchor"></a><code><span>fd : int;</span></code></li><li id="type-bpf_program.ptr" class="def record field anchored"><a href="#type-bpf_program.ptr" class="anchor"></a><code><span>ptr : <span><span><a href="../C_function_description/Types/index.html#type-bpf_program">C.Types.bpf_program</a> <span class="xref-unresolved">Ctypes</span>.structure</span> <span class="xref-unresolved">Ctypes</span>.ptr</span>;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-bpf_map"><a href="#type-bpf_map" class="anchor"></a><code><span><span class="keyword">type</span> bpf_map</span><span> = </span><span>{</span></code><ol><li id="type-bpf_map.fd" class="def record field anchored"><a href="#type-bpf_map.fd" class="anchor"></a><code><span>fd : int;</span></code></li><li id="type-bpf_map.ptr" class="def record field anchored"><a href="#type-bpf_map.ptr" class="anchor"></a><code><span>ptr : <span><span><a href="../C_function_description/Types/index.html#type-bpf_map">C.Types.bpf_map</a> <span class="xref-unresolved">Ctypes</span>.structure</span> <span class="xref-unresolved">Ctypes</span>.ptr</span>;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-bpf_link"><a href="#type-bpf_link" class="anchor"></a><code><span><span class="keyword">type</span> bpf_link</span><span> = <span><span><a href="../C_function_description/Types/index.html#type-bpf_link">C.Types.bpf_link</a> <span class="xref-unresolved">Ctypes</span>.structure</span> <span class="xref-unresolved">Ctypes</span>.ptr</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bpf_object_open"><a href="#val-bpf_object_open" class="anchor"></a><code><span><span class="keyword">val</span> bpf_object_open : <span>string <span class="arrow">&#45;&gt;</span></span> <a href="#type-bpf_object">bpf_object</a></span></code></div><div class="spec-doc"><p><code>bpf_object_open path</code> opens and tries to read the bpf_object found at path <code>path</code> in the filesystem. Libbpf parses the BPF object file and discovers BPF maps, BPF programs, and global variables. After a BPF app is opened, user space apps can make additional adjustments (setting BPF program types, if necessary; pre-setting initial values for global variables, etc.) before all the entities are created and loaded.</p><p>Fails if object file is in invalid format or path does not exist</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bpf_object_load"><a href="#val-bpf_object_load" class="anchor"></a><code><span><span class="keyword">val</span> bpf_object_load : <span><a href="#type-bpf_object">bpf_object</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>bpf_object_load obj</code> tries to load <code>obj</code>. Libbpf parses the BPF object file and discovers BPF maps, BPF programs, and global variables. After a BPF app is opened, user space apps can make additional adjustments (setting BPF program types, if necessary; pre-setting initial values for global variables, etc.) before all the entities are created and loaded.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bpf_object_find_program_by_name"><a href="#val-bpf_object_find_program_by_name" class="anchor"></a><code><span><span class="keyword">val</span> bpf_object_find_program_by_name : <span><a href="#type-bpf_object">bpf_object</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <a href="#type-bpf_program">bpf_program</a></span></code></div><div class="spec-doc"><p><code>bpf_object_find_program_by_name obj name</code> locates the program identifier <code>name</code> within the <code>obj</code>.</p><p>Fails if <code>name</code> is not found</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bpf_program_attach"><a href="#val-bpf_program_attach" class="anchor"></a><code><span><span class="keyword">val</span> bpf_program_attach : <span><a href="#type-bpf_program">bpf_program</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-bpf_link">bpf_link</a></span></code></div><div class="spec-doc"><p><code>bpf_program_attach prog</code> attaches the <code>prog</code> in the kernel to start respond to events. Libbpf attaches BPF programs to various BPF hook points (e.g., tracepoints, kprobes, cgroup hooks, network packet processing pipeline, etc.). During this phase, BPF programs perform useful work such as processing packets, or updating BPF maps and global variables that can be read from user space</p><p>Fails if link could not be attached</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bpf_program_fd"><a href="#val-bpf_program_fd" class="anchor"></a><code><span><span class="keyword">val</span> bpf_program_fd : <span><a href="#type-bpf_program">bpf_program</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>bpf_map_fd prog</code> returns the fd of the <code>prog</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bpf_object_find_map_by_name"><a href="#val-bpf_object_find_map_by_name" class="anchor"></a><code><span><span class="keyword">val</span> bpf_object_find_map_by_name : <span><a href="#type-bpf_object">bpf_object</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <a href="#type-bpf_map">bpf_map</a></span></code></div><div class="spec-doc"><p><code>bpf_object_find_map_by_name obj name</code> locates the bpf_map identifier <code>name</code> within <code>obj</code>.</p><p>Fails if map is not found</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bpf_map_fd"><a href="#val-bpf_map_fd" class="anchor"></a><code><span><span class="keyword">val</span> bpf_map_fd : <span><a href="#type-bpf_map">bpf_map</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>bpf_map_fd map</code> returns the fd of the <code>map</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bpf_link_destroy"><a href="#val-bpf_link_destroy" class="anchor"></a><code><span><span class="keyword">val</span> bpf_link_destroy : <span><a href="#type-bpf_link">bpf_link</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>bpf_link_destroy link</code> detaches and unloads the bpf program associated to <code>link</code> from the kernel</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bpf_object_close"><a href="#val-bpf_object_close" class="anchor"></a><code><span><span class="keyword">val</span> bpf_object_close : <span><a href="#type-bpf_object">bpf_object</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>bpf_object_close obj</code> tearsdown <code>obj</code>. BPF maps are destroyed, and all the resources used by the BPF app are freed.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-with_bpf_object_open_load_link"><a href="#val-with_bpf_object_open_load_link" class="anchor"></a><code><span><span class="keyword">val</span> with_bpf_object_open_load_link : 
  <span><span class="label">obj_path</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">program_names</span>:<span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?before_link</span>:<span>(<span><a href="#type-bpf_object">bpf_object</a> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><a href="#type-bpf_object">bpf_object</a> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-bpf_link">bpf_link</a> list</span> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p><code>with_bpf_object_open_load_link obj_path program_names
    ?before_link fn</code> performs opening and loading of the provided filesystem path to the bpf_object <code>obj_path</code>. This helper runs <code>before_link</code> before the program attaches the bpf programs specified in <code>program_names</code>. Initialization code should go here. <code>fn</code> is passed the bpf_object and the list of program links if all steps were successful. Ensures all the proper shutdown and cleanup of bpf_object resources and links</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bpf_map_lookup_value"><a href="#val-bpf_map_lookup_value" class="anchor"></a><code><span><span class="keyword">val</span> bpf_map_lookup_value : 
  <span><span class="label">key_ty</span>:<span><span class="type-var">'a</span> <span class="xref-unresolved">Ctypes</span>.typ</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">val_ty</span>:<span><span class="type-var">'b</span> <span class="xref-unresolved">Ctypes</span>.typ</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">val_zero</span>:<span class="type-var">'b</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-bpf_map">bpf_map</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span class="type-var">'b</span></span></code></div><div class="spec-doc"><p><code>bpf_map_lookup_value key_ty val_ty val_zero map k flags</code> Looks up the value associated with the key <code>k</code>. If key is invalid, no value is found or the size of key/value is not in sync, it will return an error. <code>bpf_map_lookup_value</code> expects <code>key_ty</code> and <code>val_ty</code> to verify the types are coherent in your bpf map declaration. <code>val_zero</code> is merely an initialization value that will be overwritten.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bpf_map_update_elem"><a href="#val-bpf_map_update_elem" class="anchor"></a><code><span><span class="keyword">val</span> bpf_map_update_elem : 
  <span><span class="label">key_ty</span>:<span><span class="type-var">'a</span> <span class="xref-unresolved">Ctypes</span>.typ</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">val_ty</span>:<span><span class="type-var">'b</span> <span class="xref-unresolved">Ctypes</span>.typ</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-bpf_map">bpf_map</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'b</span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p><code>bpf_map_update_elem key_ty val_ty map k v flags</code> updates the value associated the key <code>k</code> to <code>v</code>. If key is invalid or the size of key/value is not in sync, it will return an error. <code>bpf_map_update_elem</code> expects <code>key_ty</code> and <code>val_ty</code> to verify the types are coherent in your bpf map declaration.</p></div></div></div></body></html>
